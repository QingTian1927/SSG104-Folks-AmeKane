---
import type { Tables } from "../../../database/database.types";
import { db } from "../../../database/databaseUtils";
import type { ID } from "../../../database/models";

interface Props {
    userId: ID;
    transaction?: Tables<"Transaction">;
}
const { userId, transaction } = Astro.props;

const { data: accounts, error: accountsError } =
    await db.select.account(userId);
if (accountsError) {
    console.error(accountsError);
    return Astro.redirect("/500");
}

const { data: preferences, error: preferencesError } =
    await db.select.preferences(userId);
if (preferencesError) {
    console.error(preferencesError);
    return Astro.redirect("/500");
}

const defaultAccount = preferences[0].default_account;
---

<div class="w-full flex flex-wrap items-center justify-start gap-4">
    {
        accounts &&
            accounts.map((account) => (
                <label
                    for={account.id}
                    class="group relative w-fit p-3 rounded-md font-medium flex items-center justify-center cursor-pointer"
                >
                    <span class="">{account.title}</span>
                    <input
                        type="radio"
                        id={account.id}
                        name="account_id"
                        value={account.id}
                        checked={
                            transaction
                                ? account.id === transaction.account_id
                                    ? true
                                    : undefined
                                : account.id === defaultAccount
                                  ? true
                                  : undefined
                        }
                        required
                        class="absolute -z-[1] size-full rounded-md border-none focus:ring-transparent focus:outline-none focus:ring-offset-0 focus:bg-none checked:bg-none bg-zinc-200 group-hover:bg-zinc-300 dark:bg-zinc-700 dark:group-hover:bg-zinc-600 text-cyan-500 dark:text-blue-700 checked:group-hover:bg-cyan-500 dark:checked:group-hover:bg-blue-700"
                    />
                </label>
            ))
    }
</div>
